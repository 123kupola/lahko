---
import type { HTMLAttributes } from 'astro/types';
import { getLangFromUrl, defaultLang } from '../utils/i18n';

type Props = HTMLAttributes<'a'>;

const { href, class: className, ...props } = Astro.props;

const lang = getLangFromUrl(Astro.url);

// Normalize path to remove trailing slash for consistent comparison
const normalizePath = (path: string) => (path.length > 1 && path.endsWith('/')) ? path.slice(0, -1) : path;

const currentPath = normalizePath(Astro.url.pathname);
const linkPath = normalizePath(href!);

// Function to get the base path by stripping the language prefix
const getBasePath = (path: string, lang: string) => {
  if (lang !== defaultLang && path.startsWith(`/${lang}`)) {
    const basePath = path.substring(`/${lang}`.length);
    return basePath || '/'; // Return '/' if the path was just the language code (e.g., /en)
  }
  return path;
};

const currentBasePath = getBasePath(currentPath, lang);
const linkBasePath = getBasePath(linkPath, lang);

let isActive = false;
// The homepage link is only active on the exact homepage
if (linkBasePath === '/') {
  isActive = currentBasePath === '/';
} else {
  // Other links are active if the current path starts with the link's path
  // e.g., link to '/blog' is active on '/blog/my-post'
  isActive = currentBasePath.startsWith(linkBasePath);
}
---

<a href={href} class:list={[className, { active: isActive }]} {...props}>
	<slot />
</a>
<style>
	a {
		display: inline-block;
		text-decoration: none;
	}
	a.active {
		font-weight: bolder;
		text-decoration: underline;
	}
</style>
